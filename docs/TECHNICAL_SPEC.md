# Color Block Jam - Ğ¢ĞµÑ…Ğ½Ñ–Ñ‡Ğ½Ğ° Ğ¡Ğ¿ĞµÑ†Ğ¸Ñ„Ñ–ĞºĞ°Ñ†Ñ–Ñ (Ğ¢Ğ—)

> **Ğ’ĞµÑ€ÑÑ–Ñ:** 1.5.0  
> **Ğ”Ğ°Ñ‚Ğ° Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ:** 2025-12-23  
> **Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Ğ’ Ñ€Ğ¾Ğ·Ñ€Ğ¾Ğ±Ñ†Ñ–

---

## 1. Ğ—Ğ°Ğ³Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹ ĞĞ¿Ğ¸Ñ

### 1.1 ĞĞ°Ğ·Ğ²Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ñƒ
**Color Block Jam** - Ğ¼Ğ¾Ğ±Ñ–Ğ»ÑŒĞ½Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğ»Ğ¾Ğ¼ĞºĞ° Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ñ– Ğ¿ĞµÑ€ĞµĞ¼Ñ–Ñ‰ĞµĞ½Ğ½Ñ ĞºĞ¾Ğ»ÑŒĞ¾Ñ€Ğ¾Ğ²Ğ¸Ñ… Ğ±Ğ»Ğ¾ĞºÑ–Ğ².

### 1.2 ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ¸
| ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ | ĞœÑ–Ğ½. Ğ²ĞµÑ€ÑÑ–Ñ |
|-----------|--------|-------------|
| Android | âœ… ĞŸÑ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ÑƒÑ”Ñ‚ÑŒÑÑ | API 21 (Android 5.0) |
| iOS | âœ… ĞŸÑ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ÑƒÑ”Ñ‚ÑŒÑÑ | iOS 12.0 |
| Web | ğŸ”„ Ğ•ĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾ | Ğ¡ÑƒÑ‡Ğ°ÑĞ½Ñ– Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ¸ |
| Windows | ğŸ”„ Ğ”Ğ»Ñ Ñ€Ğ¾Ğ·Ñ€Ğ¾Ğ±ĞºĞ¸ | Windows 10+ |

### 1.3 Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ‡Ğ½Ğ¸Ğ¹ ÑÑ‚ĞµĞº
| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ | Ğ’ĞµÑ€ÑÑ–Ñ |
|-----------|------------|--------|
| Framework | Flutter | 3.x |
| ĞœĞ¾Ğ²Ğ° | Dart | 3.x |
| State Management | setState (StatefulWidget) | - |
| Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğµ ÑÑ…Ğ¾Ğ²Ğ¸Ñ‰Ğµ | shared_preferences | 2.2.x |
| Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ | CustomPainter | - |

---

## 2. ĞÑ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### 2.1 Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ñƒ
```
lib/
â”œâ”€â”€ main.dart                      # Entry point
â”œâ”€â”€ core/                          # Ğ¯Ğ´Ñ€Ğ¾ Ğ·Ğ°ÑÑ‚Ğ¾ÑÑƒĞ½ĞºÑƒ
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â”œâ”€â”€ colors.dart           # ĞŸĞ°Ğ»Ñ–Ñ‚Ñ€Ğ° ĞºĞ¾Ğ»ÑŒĞ¾Ñ€Ñ–Ğ² Ğ±Ğ»Ğ¾ĞºÑ–Ğ²
â”‚   â”‚   â””â”€â”€ block_shapes.dart     # Ğ’Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ñ„Ğ¾Ñ€Ğ¼ Ğ±Ğ»Ğ¾ĞºÑ–Ğ²
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ game_models.dart      # GameBlock, GameDoor, GameLevel, Point
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ storage_service.dart  # Ğ—Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ½Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑƒ
â”‚   â”‚   â””â”€â”€ audio_service.dart    # Ğ—Ğ²ÑƒĞºĞ¸ Ñ‚Ğ° Ğ²Ñ–Ğ±Ñ€Ğ°Ñ†Ñ–Ñ
â”‚   â””â”€â”€ widgets/
â”‚       â””â”€â”€ confetti_widget.dart  # Ğ’Ñ–Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ– ĞµÑ„ĞµĞºÑ‚Ğ¸
â”œâ”€â”€ data/
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ level_loader.dart     # Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ñ€Ñ–Ğ²Ğ½Ñ–Ğ² Ğ· JSON
â””â”€â”€ features/                      # Ğ•ĞºÑ€Ğ°Ğ½Ğ¸
    â”œâ”€â”€ menu/
    â”‚   â””â”€â”€ menu_screen.dart
    â”œâ”€â”€ level_select/
    â”‚   â””â”€â”€ level_select_screen.dart
    â”œâ”€â”€ game/
    â”‚   â””â”€â”€ game_screen.dart      # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¸Ğ¹ Ñ–Ğ³Ñ€Ğ¾Ğ²Ğ¸Ğ¹ ĞµĞºÑ€Ğ°Ğ½
    â””â”€â”€ settings/
        â””â”€â”€ settings_screen.dart

assets/
â””â”€â”€ levels/
    â””â”€â”€ levels_27.json            # Ğ”Ğ°Ğ½Ñ– 27 Ñ€Ñ–Ğ²Ğ½Ñ–Ğ² (18 Ğ²ĞµÑ€Ğ¸Ñ„Ñ–ĞºĞ¾Ğ²Ğ°Ğ½Ğ¸Ñ…)

res/
â””â”€â”€ ColorBlockJam_Analysis/       # Ğ†Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¸ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ñƒ
    â”œâ”€â”€ tools/
    â”‚   â”œâ”€â”€ parse_from_unity.py   # ĞŸĞ°Ñ€ÑĞµÑ€ Unity assets
    â”‚   â””â”€â”€ export_game_levels.py # Ğ•ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ñƒ game JSON
    â”œâ”€â”€ level_visualizer.html     # Ğ’Ñ–Ğ·ÑƒĞ°Ğ»Ñ–Ğ·Ğ°Ñ‚Ğ¾Ñ€ Ğ· ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ñ Ğ²ĞµÑ€Ğ¸Ñ„Ñ–ĞºĞ°Ñ†Ñ–Ñ—
    â”œâ”€â”€ level_data/
    â”‚   â”œâ”€â”€ parsed_levels_complete.json  # Ğ’ÑÑ– Ñ€Ğ¾Ğ·Ğ¿Ğ°Ñ€ÑĞµĞ½Ñ– Ñ€Ñ–Ğ²Ğ½Ñ–
    â”‚   â””â”€â”€ AllLevels_guids.json  # ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº Ñ€Ñ–Ğ²Ğ½Ñ–Ğ² Ñƒ Ğ³Ñ€Ñ–
    â””â”€â”€ reports/
        â””â”€â”€ RENDERING_RULES.md    # ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³Ñƒ
```

### 2.2 ĞŸĞ¾Ñ‚Ñ–Ğº Ğ´Ğ°Ğ½Ğ¸Ñ…
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ levels.json â”‚â”€â”€â”€â”€â–¶â”‚ LevelLoader  â”‚â”€â”€â”€â”€â–¶â”‚  GameLevel  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Canvas    â”‚â—€â”€â”€â”€â”€â”‚ BoardPainter â”‚â—€â”€â”€â”€â”€â”‚ GameScreen  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚StorageServiceâ”‚â—€â”€â”€â”€â”€â”‚   Win/Loss  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ĞœĞ¾Ğ´ĞµĞ»Ñ– Ğ”Ğ°Ğ½Ğ¸Ñ…

### 3.1 GameLevel
```dart
class GameLevel {
  final int id;
  final String name;
  final int gridWidth;
  final int gridHeight;
  final List<GameBlock> blocks;
  final List<GameDoor> doors;
  final List<Point> hiddenCells;
}
```

### 3.2 GameBlock
```dart
enum MoveDirection {
  horizontal,  // 0 - Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾ (â†â†’)
  vertical,    // 1 - Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾ (â†‘â†“)
  both,        // 2 - Ğ² Ğ¾Ğ±Ğ¸Ğ´Ğ²Ğ° Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ĞºĞ¸
}

class GameBlock {
  final int blockType;        // ĞšĞ¾Ğ»Ñ–Ñ€ (0-9)
  final int blockGroupType;   // Ğ¤Ğ¾Ñ€Ğ¼Ğ° (0-11)
  int gridRow;                // ĞŸĞ¾Ğ·Ğ¸Ñ†Ñ–Ñ Y
  int gridCol;                // ĞŸĞ¾Ğ·Ğ¸Ñ†Ñ–Ñ X
  final int rotationZ;        // ĞŸĞ¾Ğ²Ğ¾Ñ€Ğ¾Ñ‚ (0-3)
  final MoveDirection moveDirection;  // ĞĞ±Ğ¼ĞµĞ¶ĞµĞ½Ğ½Ñ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ĞºÑƒ Ñ€ÑƒÑ…Ñƒ
  final int innerBlockType;   // Ğ’Ğ½ÑƒÑ‚Ñ€Ñ–ÑˆĞ½Ñ–Ğ¹ ÑˆĞ°Ñ€ (-1 = Ğ½ĞµĞ¼Ğ°Ñ”, 0-9 = ĞºĞ¾Ğ»Ñ–Ñ€)
  int iceCount;               // Ğ—Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ·ĞºĞ° (0 = Ğ½Ğµ Ğ·Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹, >0 = ĞºÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ±Ğ»Ğ¾ĞºÑ–Ğ² Ğ´Ğ¾ Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ñ€Ğ¾Ğ·ĞºĞ¸)
  
  List<Point> get cells;      // ĞĞ±Ñ‡Ğ¸ÑĞ»ĞµĞ½Ñ– ĞºĞ»Ñ–Ñ‚Ğ¸Ğ½ĞºĞ¸
  bool get hasInnerLayer;     // Ğ§Ğ¸ Ñ” Ğ²Ğ½ÑƒÑ‚Ñ€Ñ–ÑˆĞ½Ñ–Ğ¹ ÑˆĞ°Ñ€
  bool get isFrozen;          // Ğ§Ğ¸ Ğ·Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ±Ğ»Ğ¾Ğº
}
```

### 3.3 GameDoor
```dart
class GameDoor {
  final int blockType;        // ĞšĞ¾Ğ»Ñ–Ñ€
  final int partCount;        // Ğ Ğ¾Ğ·Ğ¼Ñ–Ñ€ (1-4)
  final String edge;          // top/bottom/left/right
  final int startRow;
  final int startCol;
}
```

### 3.4 Ğ¢Ğ¸Ğ¿Ğ¸ Ğ±Ğ»Ğ¾ĞºÑ–Ğ² (blockGroupType)
| ID | ĞĞ°Ğ·Ğ²Ğ° | Ğ¤Ğ¾Ñ€Ğ¼Ğ° |
|----|-------|-------|
| 0 | Single | â–ª |
| 1 | Double | â–ªâ–ª |
| 2 | Triple | â–ªâ–ªâ–ª |
| 3 | Quad | â–ªâ–ªâ–ªâ–ª |
| 4 | ShortL | â–ªâ–ª â–ª |
| 5 | ShortT | â–ªâ–ªâ–ª â–ª |
| 6 | Square | â–ªâ–ª â–ªâ–ª |
| 7 | L | â–ªâ–ªâ–ª â–ª |
| 8 | ReverseL | â–ªâ–ªâ–ª â–ª (mirror) |
| 9 | T | â–ªâ–ªâ–ª â–ª |
| 10 | S | â–ªâ–ª â–ªâ–ª (zigzag) |
| 11 | Z | â–ªâ–ª â–ªâ–ª (reverse zigzag) |

---

## 4. ĞšĞ»ÑÑ‡Ğ¾Ğ²Ñ– ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¸

### 4.1 Collision Detection
```dart
bool _canMove(GameBlock block, int deltaRow, int deltaCol, GameLevel level) {
  // 0. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€Ğ¸Ñ‚Ğ¸ Ğ·Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ·ĞºÑƒ (isFrozen) - Ğ·Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ¶ĞµĞ½Ñ– Ğ±Ğ»Ğ¾ĞºĞ¸ Ğ½Ğµ Ñ€ÑƒÑ…Ğ°ÑÑ‚ÑŒÑÑ
  // 1. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€Ğ¸Ñ‚Ğ¸ Ğ¾Ğ±Ğ¼ĞµĞ¶ĞµĞ½Ğ½Ñ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ĞºÑƒ Ñ€ÑƒÑ…Ñƒ (moveDirection)
  //    - horizontal: Ğ±Ğ»Ğ¾ĞºÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Ñ€ÑƒÑ… (deltaRow != 0)
  //    - vertical: Ğ±Ğ»Ğ¾ĞºÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Ñ€ÑƒÑ… (deltaCol != 0)
  // 2. ĞĞ±Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚Ğ¸ Ğ½Ğ¾Ğ²Ñ– Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ñ–Ñ— ĞºĞ»Ñ–Ñ‚Ğ¸Ğ½Ğ¾Ğº
  // 3. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€Ğ¸Ñ‚Ğ¸ Ğ¼ĞµĞ¶Ñ– Ğ¿Ğ¾Ğ»Ñ
  // 4. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€Ğ¸Ñ‚Ğ¸ Ğ´Ğ²ĞµÑ€Ñ– (Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ Ğ²Ğ¸Ñ…Ñ–Ğ´ Ğ·Ğ° Ğ¼ĞµĞ¶Ñ– ÑĞºÑ‰Ğ¾ Ñ” Ğ´Ğ²ĞµÑ€Ñ–)
  // 5. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€Ğ¸Ñ‚Ğ¸ ĞºĞ¾Ğ»Ñ–Ğ·Ñ–Ñ— Ğ· Ñ–Ğ½ÑˆĞ¸Ğ¼Ğ¸ Ğ±Ğ»Ğ¾ĞºĞ°Ğ¼Ğ¸
  // 6. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€Ğ¸Ñ‚Ğ¸ hidden cells
}
```

### 4.2 Door Exit Detection
```dart
void _checkDoorExit(GameLevel level) {
  // 1. ĞŸÑ–Ğ´Ñ€Ğ°Ñ…ÑƒĞ²Ğ°Ñ‚Ğ¸ ĞºĞ»Ñ–Ñ‚Ğ¸Ğ½ĞºĞ¸ Ğ±Ğ»Ğ¾ĞºÑƒ Ğ·Ğ° Ğ¼ĞµĞ¶Ğ°Ğ¼Ğ¸ Ğ¿Ğ¾Ğ»Ñ
  // 2. Ğ¯ĞºÑ‰Ğ¾ >= 50% ĞºĞ»Ñ–Ñ‚Ğ¸Ğ½Ğ¾Ğº Ğ·Ğ° Ğ¼ĞµĞ¶Ğ°Ğ¼Ğ¸:
  //    - Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğ¸ Ğ°Ğ½Ñ–Ğ¼Ğ°Ñ†Ñ–Ñ Ğ²Ğ¸Ñ…Ğ¾Ğ´Ñƒ
  //    - Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ Ğ±Ğ»Ğ¾Ğº
  // 3. Ğ¯ĞºÑ‰Ğ¾ Ğ²ÑÑ– Ğ±Ğ»Ğ¾ĞºĞ¸ Ğ²Ğ¸Ğ¹ÑˆĞ»Ğ¸ -> Ğ¿ĞµÑ€ĞµĞ¼Ğ¾Ğ³Ğ°
}
```

### 4.2.1 Ğ‘Ğ°Ğ³Ğ°Ñ‚Ğ¾ÑˆĞ°Ñ€Ğ¾Ğ²Ñ– Ğ±Ğ»Ğ¾ĞºĞ¸ (Multi-layer Blocks)
Ğ‘Ğ»Ğ¾ĞºĞ¸ Ğ· `innerBlockType >= 0` Ğ¼Ğ°ÑÑ‚ÑŒ Ğ´Ğ²Ğ° ÑˆĞ°Ñ€Ğ¸ ĞºĞ¾Ğ»ÑŒĞ¾Ñ€Ñƒ: Ğ·Ğ¾Ğ²Ğ½Ñ–ÑˆĞ½Ñ–Ğ¹ (`blockType`) Ñ‚Ğ° Ğ²Ğ½ÑƒÑ‚Ñ€Ñ–ÑˆĞ½Ñ–Ğ¹ (`innerBlockType`).

**Ğ’Ñ–Ğ·ÑƒĞ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ:**
- Ğ—Ğ¾Ğ²Ğ½Ñ–ÑˆĞ½Ñ–Ğ¹ ÑˆĞ°Ñ€ Ğ²Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°Ñ”Ñ‚ÑŒÑÑ ÑĞº Ñ‚Ğ¾Ğ²ÑÑ‚Ğ° Ğ¾Ğ±Ğ²Ğ¾Ğ´ĞºĞ° Ğ±Ğ»Ğ¾ĞºÑƒ
- Ğ’Ğ½ÑƒÑ‚Ñ€Ñ–ÑˆĞ½Ñ–Ğ¹ ÑˆĞ°Ñ€ Ğ·Ğ°Ğ¿Ğ¾Ğ²Ğ½ÑÑ” ÑĞµÑ€ĞµĞ´Ğ¸Ğ½Ñƒ Ğ±Ğ»Ğ¾ĞºÑƒ Ñ‚Ğ° LEGO-ÑÑ‚Ğ°Ğ´Ğ¸

**ĞœĞµÑ…Ğ°Ğ½Ñ–ĞºĞ° Ğ²Ğ¸Ñ…Ğ¾Ğ´Ñƒ:**
```dart
void _checkLayerDestruction(GameBlock block, GameLevel level) {
  // 1. Ğ¯ĞºÑ‰Ğ¾ Ğ±Ğ»Ğ¾Ğº Ñ‚Ğ¾Ñ€ĞºĞ°Ñ”Ñ‚ÑŒÑÑ Ğ´Ğ²ĞµÑ€ĞµĞ¹ Ğ· ĞºĞ¾Ğ»ÑŒĞ¾Ñ€Ğ¾Ğ¼ Ğ—ĞĞ’ĞĞ†Ğ¨ĞĞ¬ĞĞ“Ğ ÑˆĞ°Ñ€Ñƒ:
  //    - Ğ ÑƒĞ¹Ğ½ÑƒÑ”Ñ‚ÑŒÑÑ Ğ·Ğ¾Ğ²Ğ½Ñ–ÑˆĞ½Ñ–Ğ¹ ÑˆĞ°Ñ€ (outerLayerDestroyed = true)
  //    - Ğ‘Ğ»Ğ¾Ğº Ğ·Ğ°Ğ»Ğ¸ÑˆĞ°Ñ”Ñ‚ÑŒÑÑ Ğ½Ğ° Ğ¿Ğ¾Ğ»Ñ– Ğ· ĞºĞ¾Ğ»ÑŒĞ¾Ñ€Ğ¾Ğ¼ Ğ’ĞĞ£Ğ¢Ğ Ğ†Ğ¨ĞĞ¬ĞĞ“Ğ ÑˆĞ°Ñ€Ñƒ
  //    - Ğ‘Ğ»Ğ¾Ğº ĞĞ• Ğ·Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑŒ Ğ² Ğ´Ğ²ĞµÑ€Ñ–
  // 2. ĞŸÑ–ÑĞ»Ñ Ñ€ÑƒĞ¹Ğ½ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ·Ğ¾Ğ²Ğ½Ñ–ÑˆĞ½ÑŒĞ¾Ğ³Ğ¾ ÑˆĞ°Ñ€Ñƒ:
  //    - Ğ‘Ğ»Ğ¾Ğº Ğ¼Ğ¾Ğ¶Ğµ Ğ²Ğ¸Ğ¹Ñ‚Ğ¸ Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ Ñ‡ĞµÑ€ĞµĞ· Ğ´Ğ²ĞµÑ€Ñ– Ğ’ĞĞ£Ğ¢Ğ Ğ†Ğ¨ĞĞ¬ĞĞ“Ğ ĞºĞ¾Ğ»ÑŒĞ¾Ñ€Ñƒ
  //    - ĞŸÑ€Ğ¸ Ğ²Ğ¸Ñ…Ğ¾Ğ´Ñ– Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ– Ğ´Ğ²ĞµÑ€Ñ– - Ğ±Ğ»Ğ¾Ğº Ğ²Ğ¸Ğ´Ğ°Ğ»ÑÑ”Ñ‚ÑŒÑÑ Ğ¿Ğ¾Ğ²Ğ½Ñ–ÑÑ‚Ñ
}
```

**Ğ’Ğ»Ğ°ÑÑ‚Ğ¸Ğ²Ğ¾ÑÑ‚Ñ– GameBlock Ğ´Ğ»Ñ Ğ±Ğ°Ğ³Ğ°Ñ‚Ğ¾ÑˆĞ°Ñ€Ğ¾Ğ²Ğ¸Ñ… Ğ±Ğ»Ğ¾ĞºÑ–Ğ²:**
- `innerBlockType`: ĞºĞ¾Ğ»Ñ–Ñ€ Ğ²Ğ½ÑƒÑ‚Ñ€Ñ–ÑˆĞ½ÑŒĞ¾Ğ³Ğ¾ ÑˆĞ°Ñ€Ñƒ (-1 = Ğ½ĞµĞ¼Ğ°Ñ”)
- `outerLayerDestroyed`: Ñ‡Ğ¸ Ğ·Ñ€ÑƒĞ¹Ğ½Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ·Ğ¾Ğ²Ğ½Ñ–ÑˆĞ½Ñ–Ğ¹ ÑˆĞ°Ñ€
- `activeBlockType`: Ğ¿Ğ¾Ğ²ĞµÑ€Ñ‚Ğ°Ñ” Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¸Ğ¹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹ ĞºĞ¾Ğ»Ñ–Ñ€ (Ğ·Ğ¾Ğ²Ğ½Ñ–ÑˆĞ½Ñ–Ğ¹ Ğ°Ğ±Ğ¾ Ğ²Ğ½ÑƒÑ‚Ñ€Ñ–ÑˆĞ½Ñ–Ğ¹)
- `hasInnerLayer`: Ñ‡Ğ¸ Ñ” Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹ Ğ²Ğ½ÑƒÑ‚Ñ€Ñ–ÑˆĞ½Ñ–Ğ¹ ÑˆĞ°Ñ€

### 4.2.2 Ğ—Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ¶ĞµĞ½Ñ– Ğ±Ğ»Ğ¾ĞºĞ¸ (Frozen Blocks)
Ğ‘Ğ»Ğ¾ĞºĞ¸ Ğ· `iceCount > 0` Ğ·Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ¶ĞµĞ½Ñ– Ñ– Ğ½Ğµ Ğ¼Ğ¾Ğ¶ÑƒÑ‚ÑŒ Ñ€ÑƒÑ…Ğ°Ñ‚Ğ¸ÑÑŒ.

**Ğ’Ñ–Ğ·ÑƒĞ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ:**
- ĞĞ°Ğ¿Ñ–Ğ²Ğ¿Ñ€Ğ¾Ğ·Ğ¾Ñ€Ğ¸Ğ¹ Ğ±Ğ»Ğ°ĞºĞ¸Ñ‚Ğ½Ğ¸Ğ¹ ÑˆĞ°Ñ€ Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… Ğ±Ğ»Ğ¾ĞºÑƒ
- Ğ”Ñ–Ğ°Ğ³Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹ ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ñ–Ñ‡Ğ½Ğ¸Ğ¹ Ğ²Ñ–Ğ·ĞµÑ€ÑƒĞ½Ğ¾Ğº
- Ğ‘Ñ–Ğ»Ğ¸Ğ¹ ĞºÑ€ÑƒĞ³ Ğ· Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼ iceCount Ğ¿Ğ¾ Ñ†ĞµĞ½Ñ‚Ñ€Ñƒ

**ĞœĞµÑ…Ğ°Ğ½Ñ–ĞºĞ° Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ñ€Ğ¾Ğ·ĞºĞ¸:**
```dart
void _decreaseIceCountForAll() {
  // ĞŸÑ€Ğ¸ Ğ²Ğ¸Ñ…Ğ¾Ğ´Ñ– Ğ‘Ğ£Ğ”Ğ¬-Ğ¯ĞšĞĞ“Ğ Ğ±Ğ»Ğ¾ĞºÑƒ Ñ‡ĞµÑ€ĞµĞ· Ğ´Ğ²ĞµÑ€Ñ–:
  // - Ğ—Ğ¼ĞµĞ½ÑˆĞ¸Ñ‚Ğ¸ iceCount Ğ´Ğ»Ñ Ğ’Ğ¡Ğ†Ğ¥ Ğ·Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ… Ğ±Ğ»Ğ¾ĞºÑ–Ğ² Ğ½Ğ° 1
  // - ĞšĞ¾Ğ»Ğ¸ iceCount = 0, Ğ±Ğ»Ğ¾Ğº Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ñ€Ğ¾Ğ¶ÑƒÑ”Ñ‚ÑŒÑÑ Ñ– Ğ¼Ğ¾Ğ¶Ğµ Ñ€ÑƒÑ…Ğ°Ñ‚Ğ¸ÑÑŒ
}
```

**Ğ’Ğ»Ğ°ÑÑ‚Ğ¸Ğ²Ğ¾ÑÑ‚Ñ– GameBlock Ğ´Ğ»Ñ Ğ·Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ… Ğ±Ğ»Ğ¾ĞºÑ–Ğ²:**
- `iceCount`: ĞºÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ±Ğ»Ğ¾ĞºÑ–Ğ² Ğ´Ğ¾ Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ñ€Ğ¾Ğ·ĞºĞ¸ (0 = Ğ½Ğµ Ğ·Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹)
- `isFrozen`: Ğ³ĞµÑ‚Ñ‚ĞµÑ€, Ğ¿Ğ¾Ğ²ĞµÑ€Ñ‚Ğ°Ñ” `iceCount > 0`

### 4.3 Block Shape Rotation
```dart
List<List<int>> rotateShape(List<List<int>> shape, int rotZ) {
  // rotZ: 0 = 0Â°, 1 = 90Â°, 2 = 180Â°, 3 = 270Â°
  // Ğ—Ğ°ÑÑ‚Ğ¾ÑÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ñ Ğ¿Ğ¾Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ñƒ Ğ´Ğ¾ ĞºĞ¾Ğ¶Ğ½Ğ¾Ñ— ĞºĞ»Ñ–Ñ‚Ğ¸Ğ½ĞºĞ¸
}
```

---

## 5. Ğ¡ĞµÑ€Ğ²Ñ–ÑĞ¸

### 5.1 StorageService
| ĞœĞµÑ‚Ğ¾Ğ´ | ĞĞ¿Ğ¸Ñ |
|-------|------|
| `init()` | Ğ†Ğ½Ñ–Ñ†Ñ–Ğ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ SharedPreferences |
| `getCompletedLevels()` | ĞÑ‚Ñ€Ğ¸Ğ¼Ğ°Ñ‚Ğ¸ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ñ– Ñ€Ñ–Ğ²Ğ½Ñ– |
| `markLevelCompleted(id)` | ĞŸĞ¾Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚Ğ¸ Ñ€Ñ–Ğ²ĞµĞ½ÑŒ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğ¼ |
| `getSoundEnabled()` | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ·Ğ²ÑƒĞºÑƒ |
| `getHapticEnabled()` | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ²Ñ–Ğ±Ñ€Ğ°Ñ†Ñ–Ñ— |
| `resetProgress()` | Ğ¡ĞºĞ¸Ğ½ÑƒÑ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑ |

### 5.2 AudioService
| ĞœĞµÑ‚Ğ¾Ğ´ | ĞĞ¿Ğ¸Ñ |
|-------|------|
| `lightTap()` | Ğ›ĞµĞ³ĞºĞ° Ğ²Ñ–Ğ±Ñ€Ğ°Ñ†Ñ–Ñ (ĞºĞ½Ğ¾Ğ¿ĞºĞ¸) |
| `mediumTap()` | Ğ¡ĞµÑ€ĞµĞ´Ğ½Ñ Ğ²Ñ–Ğ±Ñ€Ğ°Ñ†Ñ–Ñ (pickup) |
| `heavyTap()` | Ğ¡Ğ¸Ğ»ÑŒĞ½Ğ° Ğ²Ñ–Ğ±Ñ€Ğ°Ñ†Ñ–Ñ (drop) |
| `success()` | Ğ’Ñ–Ğ±Ñ€Ğ°Ñ†Ñ–Ñ Ğ¿ĞµÑ€ĞµĞ¼Ğ¾Ğ³Ğ¸ |
| `playPickup()` | Ğ—Ğ²ÑƒĞº Ğ¿Ñ–Ğ´Ğ½ÑÑ‚Ñ‚Ñ Ğ±Ğ»Ğ¾ĞºÑƒ |
| `playDrop()` | Ğ—Ğ²ÑƒĞº Ğ¾Ğ¿ÑƒÑĞºĞ°Ğ½Ğ½Ñ Ğ±Ğ»Ğ¾ĞºÑƒ |
| `playWin()` | Ğ—Ğ²ÑƒĞº Ğ¿ĞµÑ€ĞµĞ¼Ğ¾Ğ³Ğ¸ |

---

## 6. Ğ†Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ñ–Ñ—

### 6.1 ĞŸĞ¾Ñ‚Ğ¾Ñ‡Ğ½Ñ–
- **SharedPreferences** - Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğµ Ğ·Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ½Ñ

### 6.2 Ğ—Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ²Ğ°Ğ½Ñ–
- [ ] Firebase Analytics
- [ ] Firebase Crashlytics
- [ ] AdMob (rewarded ads)
- [ ] In-App Purchases

---

## 7. Ğ’Ğ¸Ğ¼Ğ¾Ğ³Ğ¸ Ğ´Ğ¾ ĞŸÑ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ñ–

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Ğ¦Ñ–Ğ»ÑŒ |
|---------|------|
| Startup time | < 2s |
| Frame rate | 60 FPS |
| Memory usage | < 100 MB |
| APK size | < 20 MB |
| Battery drain | ĞœÑ–Ğ½Ñ–Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹ |

---

## 8. Ğ¢ĞµÑÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ

### 8.1 Unit Tests
- [ ] GameBlock.cells calculation
- [ ] Collision detection
- [ ] Door matching

### 8.2 Widget Tests
- [ ] Menu navigation
- [ ] Level selection
- [ ] Win dialog

### 8.3 Integration Tests
- [ ] Complete level flow
- [ ] Progress saving

---

## Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ğ—Ğ¼Ñ–Ğ½

| Ğ’ĞµÑ€ÑÑ–Ñ | Ğ”Ğ°Ñ‚Ğ° | Ğ—Ğ¼Ñ–Ğ½Ğ¸ |
|--------|------|-------|
| 1.5.0 | 2025-12-23 | Ğ”Ğ¾Ğ´Ğ°Ğ½Ğ¾ iceCount - Ğ·Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ¶ĞµĞ½Ñ– Ğ±Ğ»Ğ¾ĞºĞ¸ (Ğ²Ñ–Ğ·ÑƒĞ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ + Ğ¼ĞµÑ…Ğ°Ğ½Ñ–ĞºĞ° Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ñ€Ğ¾Ğ·ĞºĞ¸) |
| 1.4.0 | 2025-12-21 | ĞœĞµÑ…Ğ°Ğ½Ñ–ĞºĞ° Ğ±Ğ°Ğ³Ğ°Ñ‚Ğ¾ÑˆĞ°Ñ€Ğ¾Ğ²Ğ¸Ñ… Ğ±Ğ»Ğ¾ĞºÑ–Ğ²: Ñ€ÑƒĞ¹Ğ½ÑƒĞ²Ğ°Ğ½Ğ½Ñ ÑˆĞ°Ñ€Ñ–Ğ² Ğ¿Ñ€Ğ¸ Ñ‚Ğ¾Ñ€ĞºĞ°Ğ½Ğ½Ñ– Ğ´Ğ²ĞµÑ€ĞµĞ¹ |
| 1.3.0 | 2025-12-21 | Ğ”Ğ¾Ğ´Ğ°Ğ½Ğ¾ innerBlockType - Ğ±Ğ°Ğ³Ğ°Ñ‚Ğ¾ÑˆĞ°Ñ€Ğ¾Ğ²Ñ– Ğ±Ğ»Ğ¾ĞºĞ¸ |
| 1.2.0 | 2025-12-21 | Ğ”Ğ¾Ğ´Ğ°Ğ½Ğ¾ MoveDirection - Ğ¾Ğ±Ğ¼ĞµĞ¶ĞµĞ½Ğ½Ñ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ĞºÑƒ Ñ€ÑƒÑ…Ñƒ Ğ±Ğ»Ğ¾ĞºÑ–Ğ² |
| 1.1.2 | 2025-12-18 | Ğ’ĞµÑ€Ğ¸Ñ„Ñ–ĞºĞ¾Ğ²Ğ°Ğ½Ğ¾ 21 Ñ€Ñ–Ğ²ĞµĞ½ÑŒ, ÑƒĞ½Ñ–Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ ReverseL |
| 1.1.1 | 2025-12-18 | Ğ’Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Level 16 (Ğ´Ğ²ĞµÑ€Ñ–), Level 19 (ShortL, Ğ´Ğ²ĞµÑ€Ñ–) |
| 1.1.0 | 2025-12-18 | ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ñƒ, 27 Ñ€Ñ–Ğ²Ğ½Ñ–Ğ² (18 Ğ²ĞµÑ€Ğ¸Ñ„Ñ–ĞºĞ¾Ğ²Ğ°Ğ½Ğ¸Ñ…) |
| 1.0.0 | 2025-12-17 | ĞŸĞ¾Ñ‡Ğ°Ñ‚ĞºĞ¾Ğ²Ğ° Ğ²ĞµÑ€ÑÑ–Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° |

